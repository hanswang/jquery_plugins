(function(d){function g(c,b,a,e,k){a&&(a="string"==typeof a?[a]:a,d.each(a,function(a,h){var f=h.split(" "),g=f.shift(),f=d.trim(f.join(" "));b&&(f=f.replace(/(^|\s)element(\s|$)/g,function(a,c,d){return c+b.selector+d}));d("body").on(g,""===d.trim(f)?null:f,function(a){a.preventDefault();e(c,d(a.currentTarget),k)})}))}function l(c,b,a){var e;if("parent"==a.relativeTo)e=c.parent();else if("element"==a.relativeTo)if(b)e=b;else throw"relativeTo was set to element, but no element provided";else a.relativeTo&&
(e=d(a.relativeTo));return d.extend({},a,{relativeTo:e})}d.fn.okPopup=function(c){return d.okPopup.create(this,c)};d.okPopup={create:function(c,b){b=d.extend({content:"",template:"<div/>",parent:"body",location:{relativeTo:"parent"},allowMultiple:!1,onInit:function(a,b){},onOpen:function(a,b){a.html(b.content)},onClose:null},b&&b.ui?d.okPopup.ui[b.ui].call(c,b):null,b);var a=d.okPopup.transitions[b.transition],e;if(!a)throw"No such transition '"+b.transition+"'";e=this.generate(b);b.onInit.call(c,
e,b);a.onInit&&a.onInit.call(c,e,b);g(e,c,b.openWhen,this.open,b);g(e,c,b.closeWhen,this.close,b);return e},generate:function(c){var b="function"==typeof c.template?c.template():c.template,b=(b instanceof jQuery?b:d(b)).appendTo(c.parent).addClass("ui-popup").hide();return b.extend({open:function(a){d.okPopup.open(b,a&&a.currentTarget?d(a.currentTarget):a,c);return b},close:function(a){d.okPopup.close(b,a&&a.currentTarget?d(a.currentTarget):a,c);return b}})},open:function(c,b,a){var e="function"==
typeof a.content?a.content(c,b):a.content,k=d.Deferred(),g=function(){c.removeClass("loading");k.resolve(d.positionAt(c,l(c,b,a.location)))},h=k.promise(),f;c.is(":visible")&&a.allowMultiple&&(c=d.okPopup.generate(a).addClass("ui-clone"));e instanceof jQuery||(e=d("<div />").html(e));c.addClass("loading");0<(f=e.find("img").andSelf().filter("img")).length&&d.fn.imagesLoaded?f.imagesLoaded(g):(f=e.find("iframe, object, embed").andSelf().filter("iframe, object, embed")).length?f.one("load",g).each(function(){this.complete&&
d(this).trigger("load")}):g();e={element:b,content:e,options:a};(h=a.onOpen(c,d.extend(e,h)))&&h.done||(h=k.promise());d.okPopup.transitions[a.transition].onOpen(c,d.extend(e,h))},close:function(c,b,a){var e=d.extend(d.Deferred(),{element:b,options:a});if(a.onClose)a.onClose(c,b);e.done(function(){c.is(".ui-clone")&&c.remove()});d.okPopup.transitions[a.transition].onClose(c,e)}}})(jQuery);
